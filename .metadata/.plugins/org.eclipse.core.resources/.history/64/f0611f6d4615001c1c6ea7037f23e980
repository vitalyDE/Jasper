<?xml version="1.0" encoding="UTF-8"?>
<!-- Created with Jaspersoft Studio version 6.2.0.final using JasperReports Library version 6.2.0  -->
<!-- 2021-09-14T15:15:11 -->
<jasperReport xmlns="http://jasperreports.sourceforge.net/jasperreports" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://jasperreports.sourceforge.net/jasperreports http://jasperreports.sourceforge.net/xsd/jasperreport.xsd" name="main" pageWidth="595" pageHeight="842" columnWidth="550" leftMargin="25" rightMargin="20" topMargin="15" bottomMargin="15" uuid="55f2a5fb-b675-4a67-bb7c-c6e13794d7dc">
	<property name="com.jaspersoft.studio.unit." value="pixel"/>
	<property name="com.jaspersoft.studio.data.defaultdataadapter" value="A0146"/>
	<style name="Table_TH" mode="Opaque" backcolor="#F0F8FF">
		<box>
			<pen lineWidth="0.5" lineColor="#000000"/>
			<topPen lineWidth="0.5" lineColor="#000000"/>
			<leftPen lineWidth="0.5" lineColor="#000000"/>
			<bottomPen lineWidth="0.5" lineColor="#000000"/>
			<rightPen lineWidth="0.5" lineColor="#000000"/>
		</box>
	</style>
	<style name="Table_TD" mode="Opaque" backcolor="#FFFFFF">
		<box>
			<pen lineWidth="0.5" lineColor="#000000"/>
			<topPen lineWidth="0.5" lineColor="#000000"/>
			<leftPen lineWidth="0.5" lineColor="#000000"/>
			<bottomPen lineWidth="0.5" lineColor="#000000"/>
			<rightPen lineWidth="0.5" lineColor="#000000"/>
		</box>
	</style>
	<style name="Table_CH" mode="Opaque" backcolor="#BFE1FF">
		<box>
			<pen lineWidth="0.5" lineColor="#000000"/>
			<topPen lineWidth="0.5" lineColor="#000000"/>
			<leftPen lineWidth="0.5" lineColor="#000000"/>
			<bottomPen lineWidth="0.5" lineColor="#000000"/>
			<rightPen lineWidth="0.5" lineColor="#000000"/>
		</box>
	</style>
	<parameter name="RESEARCH_ID" class="java.lang.String"/>
	<parameter name="ROOT_REPORT_PATH" class="java.lang.String"/>
	<queryString language="plsql">
		<![CDATA[WITH tab AS
 (SELECT rownum rn
               ,column_value
    FROM TABLE(p_collections.string_to_table_of_id($P{RESEARCH_ID})))
SELECT DISTINCT
              (select nvl(nvl(printtext,text),'Клинико-диагностическая лаборатория') 
                FROM V_THIS_LPU_DATA) as lpu
             ,r.patient_id
             ,r.root_id as research_id
             ,r.id AS specimen_id
             ,substr(r.ids, 1, 1) AS lab
             ,t.rn
             ,MIN(t.rn) over(PARTITION BY r.patient_id ORDER BY t.rn) AS pat_grp_rn
             ,MIN(t.rn) over(PARTITION BY r.root_id ORDER BY t.rn) AS root_grp_rn
  FROM solution_lab.research r
             ,tab                   t
 WHERE (r.root_id = column_value OR (r.id = column_value AND r.root_id IS NOT NULL))
 ORDER BY pat_grp_rn, root_grp_rn, rn]]>
	</queryString>
	<field name="LPU" class="java.lang.String"/>
	<field name="LAB" class="java.lang.String"/>
	<field name="PATIENT_ID" class="java.lang.String"/>
	<field name="RESEARCH_ID" class="java.lang.String"/>
	<field name="SPECIMEN_ID" class="java.lang.String"/>
	<variable name="CURRENT_DATE" class="java.lang.String">
		<variableExpression><![CDATA[new SimpleDateFormat("dd.MM.yyyy HH:mm:ss").format(new java.util.Date())]]></variableExpression>
	</variable>
	<variable name="CURRENT_PAGE_NUMBER" class="java.lang.Integer" resetType="None">
		<variableExpression><![CDATA[$V{CURRENT_PAGE_NUMBER} != null ? $V{CURRENT_PAGE_NUMBER} + 1 : 1]]></variableExpression>
		<initialValueExpression><![CDATA[0]]></initialValueExpression>
	</variable>
	<variable name="CITO" class="java.lang.Integer"/>
	<group name="PATIENT" isStartNewPage="true" isResetPageNumber="true" isReprintHeaderOnEachPage="true" footerPosition="StackAtBottom">
		<groupExpression><![CDATA[$F{PATIENT_ID}]]></groupExpression>
		<groupHeader>
			<band height="12" splitType="Prevent">
				<image vAlign="Middle" onErrorType="Blank">
					<reportElement x="3" y="0" width="12" height="12" isPrintInFirstWholeBand="true" uuid="42ff39fe-27dc-491c-913b-eb6a90fd2412">
						<property name="com.jaspersoft.studio.unit.y" value="pixel"/>
						<property name="com.jaspersoft.studio.unit.width" value="pixel"/>
						<property name="com.jaspersoft.studio.unit.height" value="pixel"/>
					</reportElement>
					<imageExpression><![CDATA[$P{ROOT_REPORT_PATH} + "/../static/address-card.png"]]></imageExpression>
				</image>
				<subreport>
					<reportElement x="20" y="0" width="530" height="12" isRemoveLineWhenBlank="true" isPrintInFirstWholeBand="true" uuid="c7c94097-9c05-4d50-a889-13f7ebc27107">
						<property name="com.jaspersoft.studio.unit.x" value="pixel"/>
					</reportElement>
					<subreportParameter name="PATIENT_ID">
						<subreportParameterExpression><![CDATA[$F{PATIENT_ID}]]></subreportParameterExpression>
					</subreportParameter>
					<connectionExpression><![CDATA[$P{REPORT_CONNECTION}]]></connectionExpression>
					<subreportExpression><![CDATA[$P{ROOT_REPORT_PATH} + "/patient.jasper"]]></subreportExpression>
				</subreport>
			</band>
		</groupHeader>
		<groupFooter>
			<band>
				<property name="com.jaspersoft.studio.unit.height" value="pixel"/>
			</band>
		</groupFooter>
	</group>
	<group name="RESEARCH" isStartNewPage="true" isResetPageNumber="true" isReprintHeaderOnEachPage="true" minHeightToStartNewPage="120">
		<groupExpression><![CDATA[$F{RESEARCH_ID}]]></groupExpression>
		<groupHeader>
			<band height="12" splitType="Prevent">
				<image vAlign="Middle" onErrorType="Blank">
					<reportElement x="3" y="0" width="12" height="12" isPrintInFirstWholeBand="true" uuid="7237ae6f-543c-42a5-ab3e-6e790fcdd7b7">
						<property name="com.jaspersoft.studio.unit.x" value="pixel"/>
						<property name="com.jaspersoft.studio.unit.y" value="pixel"/>
					</reportElement>
					<imageExpression><![CDATA[$P{ROOT_REPORT_PATH} + "/../static/file-alt.png"]]></imageExpression>
				</image>
				<subreport>
					<reportElement x="20" y="0" width="530" height="12" isRemoveLineWhenBlank="true" isPrintInFirstWholeBand="true" uuid="f730ae88-eb20-4ca1-bf0f-ad03b10e9224">
						<property name="com.jaspersoft.studio.unit.width" value="pixel"/>
						<property name="com.jaspersoft.studio.unit.x" value="pixel"/>
					</reportElement>
					<subreportParameter name="RESEARCH_ID">
						<subreportParameterExpression><![CDATA[$F{RESEARCH_ID}]]></subreportParameterExpression>
					</subreportParameter>
					<connectionExpression><![CDATA[$P{REPORT_CONNECTION}]]></connectionExpression>
					<subreportExpression><![CDATA[$P{ROOT_REPORT_PATH} + "/research.jasper"]]></subreportExpression>
				</subreport>
			</band>
		</groupHeader>
		<groupFooter>
			<band splitType="Stretch">
				<property name="com.jaspersoft.studio.unit.height" value="pixel"/>
			</band>
		</groupFooter>
	</group>
	<group name="SPECIMEN" isStartNewPage="true" isResetPageNumber="true" isReprintHeaderOnEachPage="true">
		<groupExpression><![CDATA[$F{SPECIMEN_ID}]]></groupExpression>
		<groupHeader>
			<band height="12" splitType="Prevent">
				<image vAlign="Middle" onErrorType="Blank">
					<reportElement x="3" y="0" width="12" height="12" isPrintInFirstWholeBand="true" uuid="1e32e228-7f79-4b11-85fb-6099d2b52a01">
						<property name="com.jaspersoft.studio.unit.x" value="pixel"/>
						<property name="com.jaspersoft.studio.unit.y" value="pixel"/>
					</reportElement>
					<imageExpression><![CDATA[$P{ROOT_REPORT_PATH} + "/../static/vial.png"]]></imageExpression>
				</image>
				<subreport>
					<reportElement x="20" y="0" width="530" height="12" isRemoveLineWhenBlank="true" isPrintInFirstWholeBand="true" uuid="690536b6-8f2a-4e08-a35c-12722d95b7e9">
						<property name="com.jaspersoft.studio.unit.width" value="pixel"/>
						<property name="com.jaspersoft.studio.unit.x" value="pixel"/>
					</reportElement>
					<subreportParameter name="RESEARCH_ID">
						<subreportParameterExpression><![CDATA[$F{SPECIMEN_ID}]]></subreportParameterExpression>
					</subreportParameter>
					<connectionExpression><![CDATA[$P{REPORT_CONNECTION}]]></connectionExpression>
					<subreportExpression><![CDATA[$P{ROOT_REPORT_PATH} + "/specimen.jasper"]]></subreportExpression>
				</subreport>
			</band>
		</groupHeader>
	</group>
	<pageHeader>
		<band height="85" splitType="Prevent">
			<property name="com.jaspersoft.studio.unit.height" value="pixel"/>
			<staticText>
				<reportElement x="0" y="0" width="550" height="50" uuid="a4d7d305-40a6-4795-ad14-da10752dac30">
					<property name="com.jaspersoft.studio.unit.width" value="pixel"/>
				</reportElement>
				<textElement textAlignment="Center" verticalAlignment="Top">
					<font fontName="DejaVu Sans" size="14"/>
				</textElement>
				<text><![CDATA[Министерство здравоохранения Свердловской области
ГАУЗ СО «СОКП госпиталь для ветеранов войн»
620036, г.Екатеринбург, ул.Соболева, 25

376-92-84, 376-91-65]]></text>
			</staticText>
			<staticText>
				<reportElement x="100" y="55" width="350" height="20" uuid="b7ada450-b33b-4580-86a4-56468b060987">
					<property name="com.jaspersoft.studio.unit.height" value="pixel"/>
				</reportElement>
				<box padding="1" leftPadding="5"/>
				<textElement textAlignment="Center" verticalAlignment="Top">
					<font fontName="DejaVu Sans" size="12" isBold="false"/>
					<paragraph spacingBefore="0" spacingAfter="0"/>
				</textElement>
				<text><![CDATA[Направление на анализы]]></text>
			</staticText>
			<textField evaluationTime="Group" evaluationGroup="SPECIMEN" isBlankWhenNull="true">
				<reportElement x="450" y="55" width="100" height="20" uuid="cada145d-0910-48c9-9730-856ef989e096">
					<property name="com.jaspersoft.studio.unit.y" value="pixel"/>
				</reportElement>
				<textElement textAlignment="Right" verticalAlignment="Middle">
					<font fontName="DejaVu Sans" size="12" isBold="true"/>
				</textElement>
				<textFieldExpression><![CDATA[$V{CITO} == 1 ? "CITO" : null]]></textFieldExpression>
			</textField>
		</band>
	</pageHeader>
	<detail>
		<band height="12" splitType="Stretch">
			<subreport>
				<reportElement x="0" y="0" width="550" height="12" isRemoveLineWhenBlank="true" isPrintInFirstWholeBand="true" uuid="7375d2b4-0f22-41cc-b7fc-a750893a92c6">
					<property name="com.jaspersoft.studio.unit.width" value="pixel"/>
					<property name="com.jaspersoft.studio.unit.x" value="pixel"/>
				</reportElement>
				<subreportParameter name="RESEARCH_ID">
					<subreportParameterExpression><![CDATA[$F{SPECIMEN_ID}]]></subreportParameterExpression>
				</subreportParameter>
				<connectionExpression><![CDATA[$P{REPORT_CONNECTION}]]></connectionExpression>
				<returnValue subreportVariable="CITO_EXISTS" toVariable="CITO"/>
				<subreportExpression><![CDATA[$P{ROOT_REPORT_PATH} + "/services.jasper"]]></subreportExpression>
			</subreport>
		</band>
	</detail>
	<pageFooter>
		<band height="10">
			<textField evaluationTime="Auto" pattern="">
				<reportElement positionType="FixRelativeToBottom" mode="Opaque" x="0" y="0" width="400" height="10" uuid="542e37c9-3b58-45fd-90bc-9c33a8a31c34">
					<property name="com.jaspersoft.studio.unit.width" value="pixel"/>
					<property name="com.jaspersoft.studio.unit.x" value="pixel"/>
					<property name="com.jaspersoft.studio.unit.y" value="pixel"/>
					<property name="com.jaspersoft.studio.unit.height" value="pixel"/>
					<printWhenExpression><![CDATA[1 == 1]]></printWhenExpression>
				</reportElement>
				<box>
					<rightPen lineWidth="0.0"/>
				</box>
				<textElement verticalAlignment="Bottom">
					<font fontName="DejaVu Sans" size="8"/>
				</textElement>
				<textFieldExpression><![CDATA["Напечатано в ЛИС 'Ариадна': " + $V{CURRENT_DATE}]]></textFieldExpression>
			</textField>
			<textField evaluationTime="Page">
				<reportElement positionType="FixRelativeToBottom" mode="Opaque" x="400" y="0" width="120" height="10" uuid="d48c03a2-3ac5-41ea-8131-567de9673c23">
					<property name="com.jaspersoft.studio.unit.height" value="pixel"/>
				</reportElement>
				<textElement textAlignment="Right" verticalAlignment="Bottom">
					<font fontName="DejaVu Sans" size="8"/>
				</textElement>
				<textFieldExpression><![CDATA["стр. " + $V{PAGE_NUMBER}]]></textFieldExpression>
			</textField>
			<textField evaluationTime="Group" evaluationGroup="SPECIMEN">
				<reportElement positionType="FixRelativeToBottom" mode="Opaque" x="520" y="0" width="30" height="10" uuid="67028935-4b3e-4e84-b815-f8751e55756f">
					<property name="com.jaspersoft.studio.unit.y" value="pixel"/>
					<property name="com.jaspersoft.studio.unit.height" value="pixel"/>
					<property name="com.jaspersoft.studio.unit.width" value="pixel"/>
				</reportElement>
				<textElement textAlignment="Left" verticalAlignment="Bottom">
					<font fontName="DejaVu Sans" size="8"/>
				</textElement>
				<textFieldExpression><![CDATA[" из " + $V{PAGE_NUMBER}]]></textFieldExpression>
			</textField>
		</band>
	</pageFooter>
</jasperReport>
